<!DOCTYPE html>
<html lang="fr">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<script crossorigin="anonymous" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.19.2/moment.js"></script>

<title>Document</title>

<h1>Frise chronologique</h1>

<section id="events">
</section>

<script>
'use strict';

const renderEvents = () => {
  const container = document.querySelector('#events');

  fetch('http://api.daktary.com/la-contree/baseline/tree/master/events')
    .then(response => response.json())
    .then(events => {
      events.body.forEach(event => {
        const article = TimelineEvent(event);
        container.append(article);
      });
    });
};

const TimelineEvent = (event) => {
  const article = document.createElement('article');

  const buzzer = document.createElement('a');
  buzzer.href = event.meta.url;

  const title = document.createElement('h2');
  title.textContent = event.meta.name;
  buzzer.append(title);

  const dateStart = document.createElement('time');
  dateStart.datetime = event.meta['date-start'];
  dateStart.textContent = moment(event.meta['date-start']).format('MMMM Do YYYY');
  buzzer.append(dateStart);

  const endDate = event.meta['date-end'];
  if(endDate){
    const dateEnd = document.createElement('time');
    dateEnd.datetime = endDate;
    dateEnd.textContent = moment(endDate).format('MMMM Do YYYY');
    buzzer.append(dateEnd);
  }

  const people = event.meta['people']
  const peopleList = document.createElement('ul');
  people.forEach(person => {
    const li = document.createElement('li');
    li.textContent = person;
    peopleList.append(li);
  })
  buzzer.append(peopleList);

  const content = document.createElement('div');
  content.innerHTML = event.body;
  buzzer.append(content);

  article.append(buzzer);
  return article;
}

renderEvents();
</script>

</html>
